/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/utils.py:429: FutureWarning: Importing read_csv from `anndata` is deprecated. Import anndata.io.read_csv instead.
  warnings.warn(msg, FutureWarning)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/utils.py:429: FutureWarning: Importing read_excel from `anndata` is deprecated. Import anndata.io.read_excel instead.
  warnings.warn(msg, FutureWarning)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/utils.py:429: FutureWarning: Importing read_hdf from `anndata` is deprecated. Import anndata.io.read_hdf instead.
  warnings.warn(msg, FutureWarning)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/utils.py:429: FutureWarning: Importing read_loom from `anndata` is deprecated. Import anndata.io.read_loom instead.
  warnings.warn(msg, FutureWarning)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/utils.py:429: FutureWarning: Importing read_mtx from `anndata` is deprecated. Import anndata.io.read_mtx instead.
  warnings.warn(msg, FutureWarning)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/utils.py:429: FutureWarning: Importing read_text from `anndata` is deprecated. Import anndata.io.read_text instead.
  warnings.warn(msg, FutureWarning)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/utils.py:429: FutureWarning: Importing read_umi_tools from `anndata` is deprecated. Import anndata.io.read_umi_tools instead.
  warnings.warn(msg, FutureWarning)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/_core/anndata.py:401: FutureWarning: The dtype argument is deprecated and will be removed in late 2024.
  warnings.warn(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/_core/anndata.py:401: FutureWarning: The dtype argument is deprecated and will be removed in late 2024.
  warnings.warn(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scanpy/tools/_score_genes.py:175: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  adata.obs[score_name] = pd.Series(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/_core/anndata.py:401: FutureWarning: The dtype argument is deprecated and will be removed in late 2024.
  warnings.warn(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/_core/anndata.py:401: FutureWarning: The dtype argument is deprecated and will be removed in late 2024.
  warnings.warn(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scanpy/tools/_score_genes.py:175: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  adata.obs[score_name] = pd.Series(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/_core/anndata.py:401: FutureWarning: The dtype argument is deprecated and will be removed in late 2024.
  warnings.warn(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/anndata/_core/anndata.py:401: FutureWarning: The dtype argument is deprecated and will be removed in late 2024.
  warnings.warn(
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
During startup - Warning message:
package ‘stats’ in options("defaultPackages") was not found 
Traceback (most recent call last):
  File "/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/kbet.py", line 85, in kBET
    ro.r("library(kBET)")
  File "/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/rpy2/robjects/__init__.py", line 509, in __call__
    res, visible = rinterface.evalr_expr_with_visible(   # type: ignore
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/rpy2/rinterface.py", line 194, in evalr_expr_with_visible
    raise embedded.RRuntimeError(_rinterface._geterrmessage())
rpy2.rinterface_lib.embedded.RRuntimeError: Error in library(kBET) : there is no package called ‘kBET’


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py", line 82, in <module>
    evaluate_batch_correction(
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py", line 26, in evaluate_batch_correction
    metrics = scib.metrics.metrics(
              ^^^^^^^^^^^^^^^^^^^^^
  File "/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/metrics.py", line 406, in metrics
    kbet_score = kBET(
                 ^^^^^
  File "/software/cellgen/team298/sm54/envs/CellRank/lib/python3.11/site-packages/scib/metrics/kbet.py", line 87, in kBET
    raise OptionalDependencyNotInstalled(e, "kBET")
scib.exceptions.OptionalDependencyNotInstalled: 
'kBET' is an optional dependency and not installed by default. Please make sure you install it manually.
