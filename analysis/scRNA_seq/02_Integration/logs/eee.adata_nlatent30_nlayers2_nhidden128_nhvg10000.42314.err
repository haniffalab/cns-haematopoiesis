/env/lib/python3.10/site-packages/scib/metrics/metrics.py:293: DeprecationWarning: Call to deprecated function (or staticmethod) opt_louvain.
  res_max, nmi_max, nmi_all = opt_louvain(
Traceback (most recent call last):
  File "/env/lib/python3.10/site-packages/scib/metrics/clustering.py", line 196, in opt_louvain
    adata.uns["neighbors"]
KeyError: 'neighbors'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py", line 90, in <module>
    evaluate_batch_correction(
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py", line 26, in evaluate_batch_correction
    metrics = scib.metrics.metrics(
  File "/env/lib/python3.10/site-packages/scib/metrics/metrics.py", line 293, in metrics
    res_max, nmi_max, nmi_all = opt_louvain(
  File "/env/lib/python3.10/site-packages/deprecated/classic.py", line 199, in wrapper_function
    return wrapped_(*args_, **kwargs_)
  File "/env/lib/python3.10/site-packages/scib/metrics/clustering.py", line 200, in opt_louvain
    sc.pp.neighbors(adata, use_rep=use_rep)
  File "/env/lib/python3.10/site-packages/scanpy/neighbors/__init__.py", line 191, in neighbors
    neighbors.compute_neighbors(
  File "/env/lib/python3.10/site-packages/scanpy/neighbors/__init__.py", line 573, in compute_neighbors
    self._distances = transformer.fit_transform(X)
  File "/env/lib/python3.10/site-packages/sklearn/utils/_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
  File "/env/lib/python3.10/site-packages/pynndescent/pynndescent_.py", line 2261, in fit_transform
    self.index_.compress_index()
  File "/env/lib/python3.10/site-packages/pynndescent/pynndescent_.py", line 1683, in compress_index
    self.prepare()
  File "/env/lib/python3.10/site-packages/pynndescent/pynndescent_.py", line 1696, in prepare
    self._init_search_graph()
  File "/env/lib/python3.10/site-packages/pynndescent/pynndescent_.py", line 1033, in _init_search_graph
    tree_scores = [
  File "/env/lib/python3.10/site-packages/pynndescent/pynndescent_.py", line 1034, in <listcomp>
    score_linked_tree(tree, self._neighbor_graph[0])
KeyboardInterrupt
Terminated
