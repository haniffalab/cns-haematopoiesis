Reading unintegrated AnnData...
Unintegrated data loaded.
Reading integrated AnnData...
Integrated data loaded.
Starting evaluation...
Transferred Technology and majority_voting_Level2 to integrated AnnData.
Aliased SCVI graph to neighbors/distances/connectivities.
Warning: majority_voting_Level2 contains NaN values. Dropping these cells...
/env/lib/python3.10/site-packages/scib/metrics/metrics.py:293: DeprecationWarning: Call to deprecated function (or staticmethod) opt_louvain.
  res_max, nmi_max, nmi_all = opt_louvain(
Clustering...
resolution: 0.1, nmi: 0.4748334480244792
resolution: 0.2, nmi: 0.4801625852882639
resolution: 0.3, nmi: 0.4757905521912021
resolution: 0.4, nmi: 0.4701815349111174
resolution: 0.5, nmi: 0.48097710679784034
resolution: 0.6, nmi: 0.4687209952183281
resolution: 0.7, nmi: 0.47196606204480535
resolution: 0.8, nmi: 0.47112516239781643
resolution: 0.9, nmi: 0.46839085329141184
resolution: 1.0, nmi: 0.47139119274155156
resolution: 1.1, nmi: 0.46140943822294506
resolution: 1.2, nmi: 0.4706309340661035
resolution: 1.3, nmi: 0.46049028023767324
resolution: 1.4, nmi: 0.4624112334095553
resolution: 1.5, nmi: 0.455410971761739
resolution: 1.6, nmi: 0.44702794074999347
resolution: 1.7, nmi: 0.45054897392288334
resolution: 1.8, nmi: 0.4511515996730898
resolution: 1.9, nmi: 0.4453066059686346
resolution: 2.0, nmi: 0.44259561658893376
optimised clustering against majority_voting_Level2
optimal cluster resolution: 0.5
optimal score: 0.48097710679784034
NMI...
ARI...
Silhouette score...
Graph connectivity...
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
kBET...
batch: Technology
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 7015.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
Adding diffusion to step 7
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 1086.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
Adding diffusion to step 7
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 990.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 811.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
Adding diffusion to step 7
Adding diffusion to step 8
Adding diffusion to step 9
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 852.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
Adding diffusion to step 7
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 314.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 7855.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 89.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 1069.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
Adding diffusion to step 7
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 681.
Use 70 nearest neighbors.
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:158: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  comp_size = pd.value_counts(labs)
Adding diffusion to step 4
Adding diffusion to step 5
Adding diffusion to step 6
/env/lib/python3.10/site-packages/scib/metrics/kbet.py:229: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  anndata2ri.activate()
importing expression matrix
kBET estimation
Number of kBET tests is set to 4497.
Haematopoietic consists of a single batch or is too small. Skip.
MK consists of a single batch or is too small. Skip.
Progenitor consists of a single batch or is too small. Skip.
/env/lib/python3.10/site-packages/scib/metrics/highly_variable_genes.py:35: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  hvg_dir[i.obs[batch][0]] = i.var.index[hvg["highly_variable"]]
/env/lib/python3.10/site-packages/scib/metrics/highly_variable_genes.py:35: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  hvg_dir[i.obs[batch][0]] = i.var.index[hvg["highly_variable"]]
/env/lib/python3.10/site-packages/scib/metrics/highly_variable_genes.py:76: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  batch_var = ad_post.obs[batch_key][0]
/env/lib/python3.10/site-packages/scib/metrics/highly_variable_genes.py:76: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  batch_var = ad_post.obs[batch_key][0]
Traceback (most recent call last):
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py", line 91, in <module>
    evaluate_batch_correction(
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py", line 62, in evaluate_batch_correction
    metrics.to_csv(output_csv, index=True)
  File "/env/lib/python3.10/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/env/lib/python3.10/site-packages/pandas/core/generic.py", line 3967, in to_csv
    return DataFrameRenderer(formatter).to_csv(
  File "/env/lib/python3.10/site-packages/pandas/io/formats/format.py", line 1014, in to_csv
    csv_formatter.save()
  File "/env/lib/python3.10/site-packages/pandas/io/formats/csvs.py", line 251, in save
    with get_handle(
  File "/env/lib/python3.10/site-packages/pandas/io/common.py", line 749, in get_handle
    check_parent_directory(str(handle))
  File "/env/lib/python3.10/site-packages/pandas/io/common.py", line 616, in check_parent_directory
    raise OSError(rf"Cannot save file into a non-existent directory: '{parent}'")
OSError: Cannot save file into a non-existent directory: 'haem_scib_/lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/scib_output'

------------------------------------------------------------
Sender: LSF System <lsfadmin@node-11-5-1>
Subject: Job 603659: <module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py --adata_uninteg /nfs/team298/sm54/BoneAtlasProject/data/bone_haem_compartment/haematopoeitic_compartment_celltypist.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/processed_adata/adata_nlatent30_nlayers2_nhidden128_nhvg6000.h5ad                          --output_csv haem_scib_/lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/scib_output/adata_nlatent30_nlayers2_nhidden128_nhvg6000_evaluation_metrics_no_clisi.csv                          --batch_key Technology                          --label_key majority_voting_Level2> in cluster <farm22> Exited

Job <module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py --adata_uninteg /nfs/team298/sm54/BoneAtlasProject/data/bone_haem_compartment/haematopoeitic_compartment_celltypist.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/processed_adata/adata_nlatent30_nlayers2_nhidden128_nhvg6000.h5ad                          --output_csv haem_scib_/lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/scib_output/adata_nlatent30_nlayers2_nhidden128_nhvg6000_evaluation_metrics_no_clisi.csv                          --batch_key Technology                          --label_key majority_voting_Level2> was submitted from host <farm22-head1> by user <sm54> in cluster <farm22> at Thu Jul 17 01:09:09 2025
Job was executed on host(s) <8*node-11-5-1>, in queue <long>, as user <sm54> in cluster <farm22> at Thu Jul 17 01:40:56 2025
</nfs/users/nfs_s/sm54> was used as the home directory.
</nfs/team298/sm54/BoneAtlasProject/src/integration/bash_scripts> was used as the working directory.
Started at Thu Jul 17 01:40:56 2025
Terminated at Thu Jul 17 05:47:30 2025
Results reported at Thu Jul 17 05:47:30 2025

Your job looked like:

------------------------------------------------------------
# LSBATCH: User input
module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py --adata_uninteg /nfs/team298/sm54/BoneAtlasProject/data/bone_haem_compartment/haematopoeitic_compartment_celltypist.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/processed_adata/adata_nlatent30_nlayers2_nhidden128_nhvg6000.h5ad                          --output_csv haem_scib_/lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/scib_output/adata_nlatent30_nlayers2_nhidden128_nhvg6000_evaluation_metrics_no_clisi.csv                          --batch_key Technology                          --label_key majority_voting_Level2
------------------------------------------------------------

Exited with exit code 1.

Resource usage summary:

    CPU time :                                   18801.70 sec.
    Max Memory :                                 241111 MB
    Average Memory :                             75771.26 MB
    Total Requested Memory :                     300000.00 MB
    Delta Memory :                               58889.00 MB
    Max Swap :                                   2 MB
    Max Processes :                              4
    Max Threads :                                34
    Run time :                                   14793 sec.
    Turnaround time :                            16701 sec.

The output (if any) is above this job summary.

