Reading unintegrated AnnData...
Unintegrated data loaded.
Reading integrated AnnData...
Integrated data loaded.
Starting evaluation...
Transferred Technology and majority_voting_Level2 to integrated AnnData.
Aliased SCVI graph to neighbors/distances/connectivities.
/env/lib/python3.10/site-packages/scib/metrics/metrics.py:293: DeprecationWarning: Call to deprecated function (or staticmethod) opt_louvain.
  res_max, nmi_max, nmi_all = opt_louvain(
Clustering...
resolution: 0.1, nmi: 0.4781504916740573
resolution: 0.2, nmi: 0.46806387064638805
resolution: 0.3, nmi: 0.47438828521171
resolution: 0.4, nmi: 0.47425653859749234
resolution: 0.5, nmi: 0.46993730345287366
resolution: 0.6, nmi: 0.4710977611218496
resolution: 0.7, nmi: 0.4706839921058528
resolution: 0.8, nmi: 0.4657168285741263
resolution: 0.9, nmi: 0.4654065180399732
resolution: 1.0, nmi: 0.46349714934529107
resolution: 1.1, nmi: 0.46513327660587184
resolution: 1.2, nmi: 0.4641192820044955
resolution: 1.3, nmi: 0.46367170767081667
resolution: 1.4, nmi: 0.4596879453704652
resolution: 1.5, nmi: 0.45583040454542223
resolution: 1.6, nmi: 0.4537070220496482
resolution: 1.7, nmi: 0.4498350268781899
resolution: 1.8, nmi: 0.4489948826448952
resolution: 1.9, nmi: 0.44564761513374723
resolution: 2.0, nmi: 0.44555657623508005
optimised clustering against majority_voting_Level2
optimal cluster resolution: 0.1
optimal score: 0.4781504916740573
NMI...
ARI...
Silhouette score...
Traceback (most recent call last):
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py", line 87, in <module>
    evaluate_batch_correction(
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py", line 32, in evaluate_batch_correction
    metrics = scib.metrics.metrics(
  File "/env/lib/python3.10/site-packages/scib/metrics/metrics.py", line 329, in metrics
    asw_label = silhouette(
  File "/env/lib/python3.10/site-packages/scanpy/_utils/__init__.py", line 165, in wrapper
    return func(*args, **kwargs)
  File "/env/lib/python3.10/site-packages/scib/metrics/silhouette.py", line 49, in silhouette
    asw = silhouette_score(
  File "/env/lib/python3.10/site-packages/sklearn/utils/_param_validation.py", line 216, in wrapper
    return func(*args, **kwargs)
  File "/env/lib/python3.10/site-packages/sklearn/metrics/cluster/_unsupervised.py", line 139, in silhouette_score
    return np.mean(silhouette_samples(X, labels, metric=metric, **kwds))
  File "/env/lib/python3.10/site-packages/sklearn/utils/_param_validation.py", line 189, in wrapper
    return func(*args, **kwargs)
  File "/env/lib/python3.10/site-packages/sklearn/metrics/cluster/_unsupervised.py", line 277, in silhouette_samples
    X, labels = check_X_y(X, labels, accept_sparse=["csr"])
  File "/env/lib/python3.10/site-packages/sklearn/utils/validation.py", line 1387, in check_X_y
    y = _check_y(y, multi_output=multi_output, y_numeric=y_numeric, estimator=estimator)
  File "/env/lib/python3.10/site-packages/sklearn/utils/validation.py", line 1409, in _check_y
    _assert_all_finite(y, input_name="y", estimator_name=estimator_name)
  File "/env/lib/python3.10/site-packages/sklearn/utils/validation.py", line 105, in _assert_all_finite
    raise ValueError("Input contains NaN")
ValueError: Input contains NaN

------------------------------------------------------------
Sender: LSF System <lsfadmin@node-13-28>
Subject: Job 476300: <module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py --adata_uninteg /nfs/team298/sm54/BoneAtlasProject/data/bone_haem_compartment/haematopoeitic_compartment_celltypist.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/processed_adata/adata_nlatent25_nlayers4_nhidden128_nhvg6000.h5ad                          --output_csv haem_scib_/lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/scib_output/adata_nlatent25_nlayers4_nhidden128_nhvg6000_evaluation_metrics.csv                          --batch_key Technology                          --label_key majority_voting_Level2> in cluster <farm22> Exited

Job <module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py --adata_uninteg /nfs/team298/sm54/BoneAtlasProject/data/bone_haem_compartment/haematopoeitic_compartment_celltypist.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/processed_adata/adata_nlatent25_nlayers4_nhidden128_nhvg6000.h5ad                          --output_csv haem_scib_/lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/scib_output/adata_nlatent25_nlayers4_nhidden128_nhvg6000_evaluation_metrics.csv                          --batch_key Technology                          --label_key majority_voting_Level2> was submitted from host <farm22-head1> by user <sm54> in cluster <farm22> at Wed Jul 16 10:52:32 2025
Job was executed on host(s) <8*node-13-28>, in queue <long>, as user <sm54> in cluster <farm22> at Wed Jul 16 10:52:33 2025
</nfs/users/nfs_s/sm54> was used as the home directory.
</nfs/team298/sm54/BoneAtlasProject/src/integration/bash_scripts> was used as the working directory.
Started at Wed Jul 16 10:52:33 2025
Terminated at Wed Jul 16 11:30:21 2025
Results reported at Wed Jul 16 11:30:21 2025

Your job looked like:

------------------------------------------------------------
# LSBATCH: User input
module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/09_evaluate_batch_correction_scvi_haem.py --adata_uninteg /nfs/team298/sm54/BoneAtlasProject/data/bone_haem_compartment/haematopoeitic_compartment_celltypist.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/processed_adata/adata_nlatent25_nlayers4_nhidden128_nhvg6000.h5ad                          --output_csv haem_scib_/lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/haem_compartment/bone_atlas_scvi_runs/scib_output/adata_nlatent25_nlayers4_nhidden128_nhvg6000_evaluation_metrics.csv                          --batch_key Technology                          --label_key majority_voting_Level2
------------------------------------------------------------

Exited with exit code 1.

Resource usage summary:

    CPU time :                                   2210.38 sec.
    Max Memory :                                 8213 MB
    Average Memory :                             7091.53 MB
    Total Requested Memory :                     300000.00 MB
    Delta Memory :                               291787.00 MB
    Max Swap :                                   -
    Max Processes :                              5
    Max Threads :                                26
    Run time :                                   2266 sec.
    Turnaround time :                            2269 sec.

The output (if any) is above this job summary.

