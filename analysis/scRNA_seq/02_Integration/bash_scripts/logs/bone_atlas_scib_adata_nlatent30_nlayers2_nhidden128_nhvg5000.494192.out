Reading unintegrated AnnData...
Unintegrated data loaded.
Reading integrated AnnData...
Integrated data loaded.
Starting evaluation...
Transferred Technology and majority_voting_Level2 to integrated AnnData.
Aliased SCVI graph to neighbors/distances/connectivities.
/env/lib/python3.10/site-packages/scib/metrics/metrics.py:293: DeprecationWarning: Call to deprecated function (or staticmethod) opt_louvain.
  res_max, nmi_max, nmi_all = opt_louvain(
Clustering...
resolution: 0.1, nmi: 0.4184987195095879
resolution: 0.2, nmi: 0.4437174641493582
resolution: 0.3, nmi: 0.4482172893468056
resolution: 0.4, nmi: 0.45182687293515517
resolution: 0.5, nmi: 0.4598500060282618
resolution: 0.6, nmi: 0.4589229767805885
resolution: 0.7, nmi: 0.46366456529859207
resolution: 0.8, nmi: 0.4599097068137095
resolution: 0.9, nmi: 0.45784449188512677
resolution: 1.0, nmi: 0.45826114698664727
resolution: 1.1, nmi: 0.4477112683369445
resolution: 1.2, nmi: 0.4456845657656621
resolution: 1.3, nmi: 0.4448771217558261
resolution: 1.4, nmi: 0.4391308013211386
resolution: 1.5, nmi: 0.4401833893450819
resolution: 1.6, nmi: 0.4355877764214268
resolution: 1.7, nmi: 0.43680669460570415
resolution: 1.8, nmi: 0.43423014242965347
resolution: 1.9, nmi: 0.4330763173456994
resolution: 2.0, nmi: 0.4335893022825154
optimised clustering against majority_voting_Level2
optimal cluster resolution: 0.7
optimal score: 0.46366456529859207
NMI...
ARI...
Silhouette score...
Graph connectivity...
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
/env/lib/python3.10/site-packages/scib/metrics/graph_connectivity.py:56: FutureWarning: pandas.value_counts is deprecated and will be removed in a future version. Use pd.Series(obj).value_counts() instead.
  tab = pd.value_counts(labels)
cLISI score...
/env/lib/python3.10/site-packages/scib/metrics/lisi.py:175: UserWarning: 'batch_key' is deprecated and will be ignore
  warnings.warn("'batch_key' is deprecated and will be ignore", stacklevel=1)
Traceback (most recent call last):
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py", line 86, in <module>
    evaluate_batch_correction(
  File "/nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py", line 32, in evaluate_batch_correction
    metrics = scib.metrics.metrics(
  File "/env/lib/python3.10/site-packages/scib/metrics/metrics.py", line 425, in metrics
    clisi = clisi_graph(
  File "/env/lib/python3.10/site-packages/scib/metrics/lisi.py", line 180, in clisi_graph
    adata_tmp = recompute_knn(adata, type_, use_rep)
  File "/env/lib/python3.10/site-packages/scib/metrics/lisi.py", line 205, in recompute_knn
    return sc.pp.neighbors(adata, n_neighbors=15, use_rep=use_rep, copy=True)
  File "/env/lib/python3.10/site-packages/scanpy/neighbors/__init__.py", line 191, in neighbors
    neighbors.compute_neighbors(
  File "/env/lib/python3.10/site-packages/scanpy/neighbors/__init__.py", line 572, in compute_neighbors
    X = _choose_representation(self._adata, use_rep=use_rep, n_pcs=n_pcs)
  File "/env/lib/python3.10/site-packages/scanpy/tools/_utils.py", line 66, in _choose_representation
    raise ValueError(
ValueError: Did not find X_emb in `.obsm.keys()`. You need to compute it first.

------------------------------------------------------------
Sender: LSF System <lsfadmin@node-13-08>
Subject: Job 494192: <module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py --adata_uninteg /lustre/scratch126/cellgen/haniffa/sm54/BoneAtlasProject/data/bone_atlas_filtered_with_metadata_scvi.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/bone_atlas_scvi_runs/processed_adata/adata_nlatent30_nlayers2_nhidden128_nhvg5000.h5ad                          --output_csv /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/bone_atlas_scvi_runs/scib_output/bone_atlas_adata_nlatent30_nlayers2_nhidden128_nhvg5000_evaluation_metrics.csv                          --batch_key Technology                          --label_key majority_voting_Level2> in cluster <farm22> Exited

Job <module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py --adata_uninteg /lustre/scratch126/cellgen/haniffa/sm54/BoneAtlasProject/data/bone_atlas_filtered_with_metadata_scvi.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/bone_atlas_scvi_runs/processed_adata/adata_nlatent30_nlayers2_nhidden128_nhvg5000.h5ad                          --output_csv /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/bone_atlas_scvi_runs/scib_output/bone_atlas_adata_nlatent30_nlayers2_nhidden128_nhvg5000_evaluation_metrics.csv                          --batch_key Technology                          --label_key majority_voting_Level2> was submitted from host <farm22-head1> by user <sm54> in cluster <farm22> at Wed Jul 16 14:40:04 2025
Job was executed on host(s) <8*node-13-08>, in queue <long>, as user <sm54> in cluster <farm22> at Wed Jul 16 18:26:32 2025
</nfs/users/nfs_s/sm54> was used as the home directory.
</nfs/team298/sm54/BoneAtlasProject/src/integration/bash_scripts> was used as the working directory.
Started at Wed Jul 16 18:26:32 2025
Terminated at Thu Jul 17 08:53:14 2025
Results reported at Thu Jul 17 08:53:14 2025

Your job looked like:

------------------------------------------------------------
# LSBATCH: User input
module load cellgen/singularity;      singularity exec --cleanenv --home /tmp/sm54 --bind /lustre,/nfs /nfs/cellgeni/singularity/images/scib-1.1.5.sif           python -u /nfs/team298/sm54/BoneAtlasProject/src/integration/06_evaluate_batch_correction.py --adata_uninteg /lustre/scratch126/cellgen/haniffa/sm54/BoneAtlasProject/data/bone_atlas_filtered_with_metadata_scvi.h5ad                          --adata_int /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/bone_atlas_scvi_runs/processed_adata/adata_nlatent30_nlayers2_nhidden128_nhvg5000.h5ad                          --output_csv /lustre/scratch124/cellgen/haniffa/users/sm54/data/Bone_Atlas/bone_atlas_scvi_runs/scib_output/bone_atlas_adata_nlatent30_nlayers2_nhidden128_nhvg5000_evaluation_metrics.csv                          --batch_key Technology                          --label_key majority_voting_Level2
------------------------------------------------------------

Exited with exit code 1.

Resource usage summary:

    CPU time :                                   167665.77 sec.
    Max Memory :                                 67098 MB
    Average Memory :                             58576.07 MB
    Total Requested Memory :                     650000.00 MB
    Delta Memory :                               582902.00 MB
    Max Swap :                                   2 MB
    Max Processes :                              5
    Max Threads :                                26
    Run time :                                   52000 sec.
    Turnaround time :                            65590 sec.

The output (if any) is above this job summary.

